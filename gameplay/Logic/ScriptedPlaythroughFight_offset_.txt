00002230    SpatialPrefabBlueprint aad41549ae7d38ce5e7120291fa352db
00002228        $::PrefabBlueprint
00002228            $::Blueprint
00002228                $::EntityBusData
00002228                    $::DataBusData
00002228                        $::Asset
00002228                            $::DataContainer
00002230                            Name Gameplay/Logic/ScriptedPlaythroughFight
00002234                        PropertyConnections::array
000023c4                            member(0)::PropertyConnection
000023c4                                Source 07b58d251b400741b90d4ee2cb9c71cf
000023c8                                Target f7b054fe2cd29a4eb97abe4e185daeb1
000023cc                                SourceFieldId 193442752
000023d0                                TargetFieldId 5862146
000023d4                                ShouldNetworkValue False
000023d8                            member(1)::PropertyConnection
000023d8                                Source f7b054fe2cd29a4eb97abe4e185daeb1
000023dc                                Target 00000000
000023e0                                SourceFieldId 193453899
000023e4                                TargetFieldId 927994776
000023e8                                ShouldNetworkValue False
000023ec                            member(2)::PropertyConnection
000023ec                                Source 00000002
000023f0                                Target 07b58d251b400741b90d4ee2cb9c71cf
000023f4                                SourceFieldId -1952325234
000023f8                                TargetFieldId -1952325234
000023fc                                ShouldNetworkValue False
00002400                            member(3)::PropertyConnection
00002400                                Source 00000002
00002404                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002408                                SourceFieldId -1952325235
0000240c                                TargetFieldId -1952325235
00002410                                ShouldNetworkValue False
00002414                            member(4)::PropertyConnection
00002414                                Source 00000002
00002418                                Target 07b58d251b400741b90d4ee2cb9c71cf
0000241c                                SourceFieldId -1952325236
00002420                                TargetFieldId -1952325236
00002424                                ShouldNetworkValue False
00002428                            member(5)::PropertyConnection
00002428                                Source 00000002
0000242c                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002430                                SourceFieldId -1952325237
00002434                                TargetFieldId -1952325237
00002438                                ShouldNetworkValue False
0000243c                            member(6)::PropertyConnection
0000243c                                Source 00000002
00002440                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002444                                SourceFieldId -1952325238
00002448                                TargetFieldId -1952325238
0000244c                                ShouldNetworkValue False
00002450                            member(7)::PropertyConnection
00002450                                Source 00000002
00002454                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002458                                SourceFieldId -1952325239
0000245c                                TargetFieldId -1952325239
00002460                                ShouldNetworkValue False
00002464                            member(8)::PropertyConnection
00002464                                Source 00000002
00002468                                Target 07b58d251b400741b90d4ee2cb9c71cf
0000246c                                SourceFieldId -1952325240
00002470                                TargetFieldId -1952325240
00002474                                ShouldNetworkValue False
00002478                            member(9)::PropertyConnection
00002478                                Source 00000002
0000247c                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002480                                SourceFieldId -1952325241
00002484                                TargetFieldId -1952325241
00002488                                ShouldNetworkValue False
0000248c                            member(10)::PropertyConnection
0000248c                                Source 00000002
00002490                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002494                                SourceFieldId -1952325242
00002498                                TargetFieldId -1952325242
0000249c                                ShouldNetworkValue False
000024a0                            member(11)::PropertyConnection
000024a0                                Source 00000002
000024a4                                Target 07b58d251b400741b90d4ee2cb9c71cf
000024a8                                SourceFieldId -2223234
000024ac                                TargetFieldId -2223234
000024b0                                ShouldNetworkValue False
000024b4                            member(12)::PropertyConnection
000024b4                                Source 00000002
000024b8                                Target 07b58d251b400741b90d4ee2cb9c71cf
000024bc                                SourceFieldId -2223233
000024c0                                TargetFieldId -2223233
000024c4                                ShouldNetworkValue False
000024c8                            member(13)::PropertyConnection
000024c8                                Source 00000002
000024cc                                Target 07b58d251b400741b90d4ee2cb9c71cf
000024d0                                SourceFieldId -2223236
000024d4                                TargetFieldId -2223236
000024d8                                ShouldNetworkValue False
000024dc                            member(14)::PropertyConnection
000024dc                                Source 00000002
000024e0                                Target 07b58d251b400741b90d4ee2cb9c71cf
000024e4                                SourceFieldId -2223235
000024e8                                TargetFieldId -2223235
000024ec                                ShouldNetworkValue False
000024f0                            member(15)::PropertyConnection
000024f0                                Source 00000002
000024f4                                Target 07b58d251b400741b90d4ee2cb9c71cf
000024f8                                SourceFieldId -2223238
000024fc                                TargetFieldId -2223238
00002500                                ShouldNetworkValue False
00002504                            member(16)::PropertyConnection
00002504                                Source 00000002
00002508                                Target 07b58d251b400741b90d4ee2cb9c71cf
0000250c                                SourceFieldId -2223237
00002510                                TargetFieldId -2223237
00002514                                ShouldNetworkValue False
00002518                            member(17)::PropertyConnection
00002518                                Source 00000002
0000251c                                Target 07b58d251b400741b90d4ee2cb9c71cf
00002520                                SourceFieldId -2223240
00002524                                TargetFieldId -2223240
00002528                                ShouldNetworkValue False
0000252c                            member(18)::PropertyConnection
0000252c                                Source f7b054fe2cd29a4eb97abe4e185daeb1
00002530                                Target 00000002
00002534                                SourceFieldId 193453899
00002538                                TargetFieldId 193442752
0000253c                                ShouldNetworkValue False
00002238                        LinkConnections *nullArray*
0000223c                        Interface 00000002
00002240                        Flags 3
00002244                    EventConnections::array
00002544                        member(0)::EventConnection
00002544                            Source 00000002
00002548                            Target 07b58d251b400741b90d4ee2cb9c71cf
0000254c                            SourceEvent::EventSpec
0000254c                                Id 230748069
00002550                            TargetEvent::EventSpec
00002550                                Id -1746878587
00002554                            TargetType EventConnectionTargetType_Server
00002558                        member(1)::EventConnection
00002558                            Source 00000002
0000255c                            Target 07b58d251b400741b90d4ee2cb9c71cf
00002560                            SourceEvent::EventSpec
00002560                                Id 2089401213
00002564                            TargetEvent::EventSpec
00002564                                Id -1592264995
00002568                            TargetType EventConnectionTargetType_Server
0000256c                        member(2)::EventConnection
0000256c                            Source 00000002
00002570                            Target 07b58d251b400741b90d4ee2cb9c71cf
00002574                            SourceEvent::EventSpec
00002574                                Id 2089401213
00002578                            TargetEvent::EventSpec
00002578                                Id 2089401213
0000257c                            TargetType EventConnectionTargetType_Server
00002580                        member(3)::EventConnection
00002580                            Source 07b58d251b400741b90d4ee2cb9c71cf
00002584                            Target 00000000
00002588                            SourceEvent::EventSpec
00002588                                Id -1188560160
0000258c                            TargetEvent::EventSpec
0000258c                                Id 230748069
00002590                            TargetType EventConnectionTargetType_NetworkedClient
00002594                        member(4)::EventConnection
00002594                            Source 07b58d251b400741b90d4ee2cb9c71cf
00002598                            Target 00000000
0000259c                            SourceEvent::EventSpec
0000259c                                Id -2101777096
000025a0                            TargetEvent::EventSpec
000025a0                                Id 2089401213
000025a4                            TargetType EventConnectionTargetType_NetworkedClient
000025a8                        member(5)::EventConnection
000025a8                            Source 00000003
000025ac                            Target 00000002
000025b0                            SourceEvent::EventSpec
000025b0                                Id 230748069
000025b4                            TargetEvent::EventSpec
000025b4                                Id -568030115
000025b8                            TargetType EventConnectionTargetType_Server
000025bc                        member(6)::EventConnection
000025bc                            Source 00000003
000025c0                            Target 00000002
000025c4                            SourceEvent::EventSpec
000025c4                                Id 2089401213
000025c8                            TargetEvent::EventSpec
000025c8                                Id -639132411
000025cc                            TargetType EventConnectionTargetType_Server
000025d0                        member(7)::EventConnection
000025d0                            Source 07b58d251b400741b90d4ee2cb9c71cf
000025d4                            Target 00000003
000025d8                            SourceEvent::EventSpec
000025d8                                Id -568030115
000025dc                            TargetEvent::EventSpec
000025dc                                Id 230748069
000025e0                            TargetType EventConnectionTargetType_Server
000025e4                        member(8)::EventConnection
000025e4                            Source 07b58d251b400741b90d4ee2cb9c71cf
000025e8                            Target 00000003
000025ec                            SourceEvent::EventSpec
000025ec                                Id -639132411
000025f0                            TargetEvent::EventSpec
000025f0                                Id 232316407
000025f4                            TargetType EventConnectionTargetType_Server
000025f8                        member(9)::EventConnection
000025f8                            Source 00000003
000025fc                            Target 00000001
00002600                            SourceEvent::EventSpec
00002600                                Id 1422499549
00002604                            TargetEvent::EventSpec
00002604                                Id 550586970
00002608                            TargetType EventConnectionTargetType_Server
00002248            Objects::array
00002610                member(0) 00000000
00002614                member(1) 07b58d251b400741b90d4ee2cb9c71cf
00002618                member(2) f7b054fe2cd29a4eb97abe4e185daeb1
0000261c                member(3) 00000003
00002620                member(4) 00000001
0000225c    LuaRunnerScriptEntityData 07b58d251b400741b90d4ee2cb9c71cf
00002254        $::EntityData
00002254            $::GameObjectData
00002254                $::DataBusPeer
00002254                    $::GameDataContainer
00002254                        $::DataContainer
0000225c                    Flags 495826183
00002260        Script -- If you change this, add more input transforms
local MAX_ENEMIES = 16
-- Other settings
local TIME_PER_TARGET = 3
local ACTIVITY_THRESHOLD = 4
local AIM_TIME = 1

local function lerp(s, e, t)
	return (1 - t) * s + t * e
end

local function update(self, vars)
	-- Check which enemies are still valid targets
	for i = 1, MAX_ENEMIES, 1 do
		local name = "Enemy" .. i
		if self[name] ~= nil then
			local new = self[name].trans
			local old = vars.enemies[i].pos
			if new.x ~= old.x or new.y ~= old.y or new.z ~= old.z then
				vars.enemies[i].lastActive = vars.time
				vars.enemies[i].pos.x = new.x
				vars.enemies[i].pos.y = new.y
				vars.enemies[i].pos.z = new.z
			end
		else
			vars.enemies[i].lastActive = -10000
		end
	end

	-- Time to decide new?
	if vars.time > vars.lastDecided + TIME_PER_TARGET then
		local available = {}
		for i = 1, MAX_ENEMIES, 1 do
			if vars.enemies[i].lastActive > vars.time - ACTIVITY_THRESHOLD then
				table.insert(available, i)
			end
		end
		if #available > 0 then
			-- Save old target pos for smooth aiming
			if vars.target ~= nil and  self["Enemy" .. vars.target] ~= nil then
				vars.oldTargetPos = self["Enemy" .. vars.target].trans
			end

			local chosen = math.random(#available)
			if vars.target ~= available[chosen] and vars.firing then
				self.FireEvent("StopFire")
				vars.firing = false
			end
			vars.target = available[chosen]
			vars.aimTime = vars.time
			vars.lastDecided = vars.time
		end
	end
	
	-- Set output transform and interpolate if needed
	if vars.target ~= nil then
		local doneAiming = false
		local aimTime = 0
		if vars.oldTargetPos == nil then
			doneAiming = true
		else
			aimTime = vars.time - vars.aimTime
			if aimTime >= AIM_TIME then
				doneAiming = true
			end
		end

		if not doneAiming then
			local old = vars.oldTargetPos
			local new = self["Enemy" .. vars.target].trans
			local fraction = aimTime / AIM_TIME
			local aimX = lerp(old.x, new.x, fraction)
			local aimY = lerp(old.y, new.y, fraction)
			local aimZ = lerp(old.z, new.z, fraction)
			self.Aim = LinearTransform.FromRotTrans(LinearTransform.Identity(), Vec3.FromXYZ(aimX, aimY, aimZ))
		else
			-- Set target directly
			self.Aim = self["Enemy" .. vars.target]
			if not vars.firing then
				self.FireEvent("StartFire")
				vars.firing = true
			end
		end
		self.FireEvent("StartAim")
	end
end

--function <guid>( self, event, vars, sharedvars, globalvars, deltaTime )
do
	if vars.enemies == nil then
		vars.enemies = {}
		for i = 1, MAX_ENEMIES, 1 do
			vars.enemies[i] = {}
			local name = "Enemy" .. i
			if self[name] ~= nil then
				local pos = self[name].trans
				vars.enemies[i].pos = { x = pos.x, y = pos.y, z = pos.z }
			else
				vars.enemies[i].pos = { x = 0, y = 0, z = 0 }
			end
			vars.enemies[i].lastActive = -10000
		end
	end
	InitVars(vars, "time", 0)
	InitVars(vars, "lastDecided", -10000)
	InitVars(vars, "firing", false)

	if event == "Stop" then
		self.FireEvent("StopFire")
		self.FireEvent("StopAim")
		vars.firing = false
	elseif event == "Execute" then
		vars.time = vars.time + deltaTime
		update(self, vars)
	end
end

00002264        InputEvents::array
00002628            member(0) Stop
00002268        OutputEvents::array
00002630            member(0) StartFire
00002634            member(1) StopFire
00002638            member(2) StartAim
0000263c            member(3) StopAim
0000226c        InputFloatProperties *nullArray*
00002270        OutputFloatProperties *nullArray*
00002274        InputIntProperties *nullArray*
00002278        OutputIntProperties *nullArray*
0000227c        InputBoolProperties *nullArray*
00002280        OutputBoolProperties *nullArray*
00002284        InputStringProperties *nullArray*
00002288        OutputStringProperties *nullArray*
0000228c        InputTransformProperties::array
00002644            member(0) Enemy1
00002648            member(1) Enemy2
0000264c            member(2) Enemy3
00002650            member(3) Enemy4
00002654            member(4) Enemy5
00002658            member(5) Enemy6
0000265c            member(6) Enemy7
00002660            member(7) Enemy8
00002664            member(8) Enemy9
00002668            member(9) Enemy10
0000266c            member(10) Enemy11
00002670            member(11) Enemy12
00002674            member(12) Enemy13
00002678            member(13) Enemy14
0000267c            member(14) Enemy15
00002680            member(15) Enemy16
00002290        OutputTransformProperties::array
00002688            member(0) Aim
00002294        InputVec3Properties *nullArray*
00002298        OutputVec3Properties *nullArray*
0000229c        ExecuteOnPropertyChange ExecuteOnPropertyChangeType_DontExecute
000022a0        PriorityForExecutingPerFrame 0
000022a4        Realm Realm_Server
000022a8        CompiledLua Gameplay/Logic/ScriptedPlaythroughFight/LuaRunnerCompiledLua_258DB507_401B_4107_B90D_4EE2CB9C71CF_Win32/841942189fe953bfa0aa499e9181a236
000022ac        AutoStartExecutingPerFrame False
000022ad        AutoStartForInitialization False
000022ae        RunOnPropertyChange False
000022af        AddToDebugDisplay False
000022c0    SyncedTransformEntityData f7b054fe2cd29a4eb97abe4e185daeb1
000022c0        $::EntityData
000022c0            $::GameObjectData
000022c0                $::DataBusPeer
000022c0                    $::GameDataContainer
000022c0                        $::DataContainer
000022c8                    Flags 273985783
000022cc        Interpolate False
000022d0        In::LinearTransform
000022d0            right::Vec3
000022d0                x 1.0
000022d4                y 0.0
000022d8                z 0.0
000022e0            up::Vec3
000022e0                x 0.0
000022e4                y 1.0
000022e8                z 0.0
000022f0            forward::Vec3
000022f0                x 0.0
000022f4                y 0.0
000022f8                z 1.0
00002300            trans::Vec3
00002300                x 0.0
00002304                y 0.0
00002308                z 0.0
00002310    PlayerLookAtEntityData 00000000
00002310        $::EntityData
00002310            $::GameObjectData
00002310                $::DataBusPeer
00002310                    $::GameDataContainer
00002310                        $::DataContainer
00002318                    Flags 443644914
00002320        TargetTransform::LinearTransform
00002320            right::Vec3
00002320                x 1.0
00002324                y 0.0
00002328                z 0.0
00002330            up::Vec3
00002330                x 0.0
00002334                y 1.0
00002338                z 0.0
00002340            forward::Vec3
00002340                x 0.0
00002344                y 0.0
00002348                z 1.0
00002350            trans::Vec3
00002350                x 0.0
00002354                y 0.0
00002358                z 0.0
00002360    ConsoleCommandEntityData 00000001
00002358        $::EntityData
00002358            $::GameObjectData
00002358                $::DataBusPeer
00002358                    $::GameDataContainer
00002358                        $::DataContainer
00002360                    Flags 70176080
00002364        Commands::array
00002690            member(0) Ai2.KillOneAi true
00002368        Realm Realm_Server
0000236c    InterfaceDescriptorData 00000002
00002364        $::DynamicDataContainer
00002364            $::DataContainer
0000236c            Fields::array
00002698                member(0)::DataField
00002698                    Value *nullString*
0000269c                    ValueRef *nullGuid*
000026a0                    Id -1952325234
000026a4                    AccessType FieldAccessType_Target
000026a8                member(1)::DataField
000026a8                    Value *nullString*
000026ac                    ValueRef *nullGuid*
000026b0                    Id -1952325235
000026b4                    AccessType FieldAccessType_Target
000026b8                member(2)::DataField
000026b8                    Value *nullString*
000026bc                    ValueRef *nullGuid*
000026c0                    Id -1952325236
000026c4                    AccessType FieldAccessType_Target
000026c8                member(3)::DataField
000026c8                    Value *nullString*
000026cc                    ValueRef *nullGuid*
000026d0                    Id -1952325237
000026d4                    AccessType FieldAccessType_Target
000026d8                member(4)::DataField
000026d8                    Value *nullString*
000026dc                    ValueRef *nullGuid*
000026e0                    Id -1952325238
000026e4                    AccessType FieldAccessType_Target
000026e8                member(5)::DataField
000026e8                    Value *nullString*
000026ec                    ValueRef *nullGuid*
000026f0                    Id -1952325239
000026f4                    AccessType FieldAccessType_Target
000026f8                member(6)::DataField
000026f8                    Value *nullString*
000026fc                    ValueRef *nullGuid*
00002700                    Id -1952325240
00002704                    AccessType FieldAccessType_Target
00002708                member(7)::DataField
00002708                    Value *nullString*
0000270c                    ValueRef *nullGuid*
00002710                    Id -1952325241
00002714                    AccessType FieldAccessType_Target
00002718                member(8)::DataField
00002718                    Value *nullString*
0000271c                    ValueRef *nullGuid*
00002720                    Id -1952325242
00002724                    AccessType FieldAccessType_Target
00002728                member(9)::DataField
00002728                    Value *nullString*
0000272c                    ValueRef *nullGuid*
00002730                    Id -2223234
00002734                    AccessType FieldAccessType_Target
00002738                member(10)::DataField
00002738                    Value *nullString*
0000273c                    ValueRef *nullGuid*
00002740                    Id -2223233
00002744                    AccessType FieldAccessType_Target
00002748                member(11)::DataField
00002748                    Value *nullString*
0000274c                    ValueRef *nullGuid*
00002750                    Id -2223236
00002754                    AccessType FieldAccessType_Target
00002758                member(12)::DataField
00002758                    Value *nullString*
0000275c                    ValueRef *nullGuid*
00002760                    Id -2223235
00002764                    AccessType FieldAccessType_Target
00002768                member(13)::DataField
00002768                    Value *nullString*
0000276c                    ValueRef *nullGuid*
00002770                    Id -2223238
00002774                    AccessType FieldAccessType_Target
00002778                member(14)::DataField
00002778                    Value *nullString*
0000277c                    ValueRef *nullGuid*
00002780                    Id -2223237
00002784                    AccessType FieldAccessType_Target
00002788                member(15)::DataField
00002788                    Value *nullString*
0000278c                    ValueRef *nullGuid*
00002790                    Id -2223240
00002794                    AccessType FieldAccessType_Target
00002798                member(16)::DataField
00002798                    Value *nullString*
0000279c                    ValueRef *nullGuid*
000027a0                    Id 193442752
000027a4                    AccessType FieldAccessType_Source
00002370        InputEvents::array
000027ac            member(0)::DynamicEvent
000027ac                Id 230748069
000027b0            member(1)::DynamicEvent
000027b0                Id 2089401213
00002374        OutputEvents::array
000027b8            member(0)::DynamicEvent
000027b8                Id -568030115
000027bc            member(1)::DynamicEvent
000027bc                Id -639132411
00002378        InputLinks *nullArray*
0000237c        OutputLinks *nullArray*
00002380    SequenceEntityData 00000003
00002378        $::EntityData
00002378            $::GameObjectData
00002378                $::DataBusPeer
00002378                    $::GameDataContainer
00002378                        $::DataContainer
00002380                    Flags 83781235
00002384        Events::array
000027c4            member(0)::SequenceEventData
000027c4                Event::EventSpec
000027c4                    Id 230748069
000027c8                Time 0
000027cc            member(1)::SequenceEventData
000027cc                Event::EventSpec
000027cc                    Id 2089401213
000027d0                Time 181
000027d4            member(2)::SequenceEventData
000027d4                Event::EventSpec
000027d4                    Id 230748069
000027d8                Time 986
000027dc            member(3)::SequenceEventData
000027dc                Event::EventSpec
000027dc                    Id 2089401213
000027e0                Time 1470
000027e4            member(4)::SequenceEventData
000027e4                Event::EventSpec
000027e4                    Id 230748069
000027e8                Time 1923
000027ec            member(5)::SequenceEventData
000027ec                Event::EventSpec
000027ec                    Id 2089401213
000027f0                Time 2026
000027f4            member(6)::SequenceEventData
000027f4                Event::EventSpec
000027f4                    Id 230748069
000027f8                Time 3139
000027fc            member(7)::SequenceEventData
000027fc                Event::EventSpec
000027fc                    Id 2089401213
00002800                Time 3212
00002804            member(8)::SequenceEventData
00002804                Event::EventSpec
00002804                    Id 230748069
00002808                Time 3799
0000280c            member(9)::SequenceEventData
0000280c                Event::EventSpec
0000280c                    Id 2089401213
00002810                Time 4101
00002814            member(10)::SequenceEventData
00002814                Event::EventSpec
00002814                    Id 230748069
00002818                Time 5190
0000281c            member(11)::SequenceEventData
0000281c                Event::EventSpec
0000281c                    Id 1422499549
00002820                Time 5420
00002824            member(12)::SequenceEventData
00002824                Event::EventSpec
00002824                    Id 2089401213
00002828                Time 6557
0000282c            member(13)::SequenceEventData
0000282c                Event::EventSpec
0000282c                    Id 230748069
00002830                Time 7156
00002834            member(14)::SequenceEventData
00002834                Event::EventSpec
00002834                    Id 2089401213
00002838                Time 7319
0000283c            member(15)::SequenceEventData
0000283c                Event::EventSpec
0000283c                    Id 230748069
00002840                Time 8009
00002844            member(16)::SequenceEventData
00002844                Event::EventSpec
00002844                    Id 2089401213
00002848                Time 8402
0000284c            member(17)::SequenceEventData
0000284c                Event::EventSpec
0000284c                    Id 230748069
00002850                Time 9261
00002854            member(18)::SequenceEventData
00002854                Event::EventSpec
00002854                    Id 1422499549
00002858                Time 9384
0000285c            member(19)::SequenceEventData
0000285c                Event::EventSpec
0000285c                    Id 2089401213
00002860                Time 9431
00002388        SequenceStartTime 0
0000238c        SequenceLength 10000
00002390        Realm Realm_Server
00002394        PropertyTracks *nullArray*
00002398        CustomSequenceTracks *nullArray*
0000239c        ClientUpdatePass UpdatePass_PostFrame
000023a0        ServerUpdatePass UpdatePass_PreSim
000023a4        ExternalTime 0.0
000023a8        PlaybackSpeed 1.0
000023ac        Looping True
000023ad        AutoStart False
000023ae        AutoPlayFirstFrame False
000023af        PlayInReverse False
